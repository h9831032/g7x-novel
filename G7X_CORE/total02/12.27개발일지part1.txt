[확장 단계]

형아 OK. 오늘 작업한 거 **개발일지(꼼꼼 버전)**로 박제해둘게.
그리고 너가 말한 “개발일지 플랫폼 형식”은 앞으로 **아래 포맷으로 고정**해서 매 세션 끝에 자동으로 이걸로 쓴다(전역 저장 반영됨).

# G6X 개발일지 2025-12-28 스냅샷

## 1) 단계 판정

* 확장 단계
* Phase1 Gate(Composite) 봉인 진입, 다음 공정은 VMCL 통합(도시락 영수증 박제) 준비

## 2) 오늘 목표

* Composite Gate 실험을 “봉인 가능한 수준”으로 올리기
* REAL Writer 영수증(증거) 미생성 문제 원인 확인 및 출력 경로 정상화
* FN Top-3를 “어느 바구니(SPACE/TIME/STATE/RULE)로 새는지” 계속 추적 가능하게 만들기
* ClaimExtractor ↔ GateJudge 배선(특히 아이템/상태 쪽)에서 TP를 실제로 올리는지 확인

## 3) 오늘 한 일 요약(변경점/결정)

### A. Writer 영수증(writer_receipt) 미생성 원인 확인 → 출력 위치/파일명 문제로 판명

* 증상

  * run 폴더 안에 `writer_receipt.jsonl`이 없어서 `Test-Path`가 False
  * 실제로는 `logs\tesla_v12\writer_receipt_<RUN_ID>.jsonl` 형태로 생기고 있었음
* 근거 로그

  * `Test-Path "C:\g6core\g6_v24\logs\tesla_v12\writer_receipt_PILGRIM_COMPOSITE_V1_SMOKE2.jsonl"` True
  * tail에 HTTPError, max_retries_exceeded 기록 확인(REAL 호출 실패 영수증)

### B. PowerShell 사용 실수/제약 대응 정리

* `Select-String -First` 파라미터가 없어서 에러 발생

  * 해결: `Select-String ... | Select-Object -First N`
* 파이썬 객체 필드 변경을 PowerShell에서 하려다 실패

  * 해결: 파이썬 -c로 프리셋 출력만 확인하거나, 코드에서 프로필을 조립하는 방식으로 통일

### C. WorldProfileV12 dataclass 동결(frozen)로 인한 오류 발견 → 하네스 쪽 수정 필요

* 증상

  * `profile.time_intervention = "ON"` 시도 시 `FrozenInstanceError`
* 결론

  * 프로필은 “생성 시점에 값 확정” 구조로 써야 함
  * 하네스에서 생성 후 필드 변경 금지

### D. redteam_harness_v12.py 호출 시 GateJudgeV12 시그니처/인자 불일치 이슈 해결 흐름

* 발생했던 에러들

  * `WorldProfileV12.__init__() missing ...` (기본 생성 불가)
  * `GateJudgeV12.__init__() takes ... but 4 were given`
  * `GateJudgeV12.judge() missing required positional arguments ...`
* 결과

  * 이후 실행이 정상적으로 돌아가며 casebook 생성 확인
  * `PILGRIM_COMPOSITE_V1_SMOKE4`에서 30턴 완료 및 casebook 생성 True

### E. ClaimExtractorV12/케이스북 기록 누락 이슈 확인

* STUB 90턴에서 FN이 전부 UNKNOWN으로만 나오는 상태가 존재

  * `FN_TOP3_BUCKET [('UNKNOWN', 90)]`
  * `FN_TOP3_POISON [('UNKNOWN', 90)]`
* 이건 “poison_bucket/poison_id를 케이스북에 제대로 안 박거나, extractor 결과가 비어있거나, 기록 키명이 바뀐” 케이스로 판단

### F. 아이템(ASSET) 배선 적용 후 TP 급상승 확인(핵심 성과)

* 실행

  * `PILGRIM_COMPOSITE_STUB_90_ASSET`
* 결과

  * `[DONE] tp=70 fp=0 fn=20`
  * `FN_TOP3_BUCKET [('STATE', 20)]`
* 의미

  * “Extractor가 뽑는 증거를 Judge가 무시하고 있던 상태”가 일부 해소됨
  * 제미나이가 말한 “아이템 배선하면 TP 오른다”는 방향성 자체는 맞았음(단, 구현 품질/증거 박제는 별개)

### G. V124 기준선에서 FN이 SPACE/TIME로 이동 확인

* 결과(형아 로그)

  * `PILGRIM_COMPOSITE_STUB_90_V124`에서 TP=30 FP=0 FN=29
  * `FN_TOP3_BUCKET [('SPACE', 19), ('TIME', 10)]`
* 의미

  * 이제 병목은 STATE가 아니라 SPACE/TIME 쪽(특히 암시형 이동/시간개입/속도상한/정규식 추출 누수)

## 4) 오늘 실행 커맨드 기록(재현용)

* REAL Writer 영수증 확인

  * `Test-Path "C:\g6core\g6_v24\logs\tesla_v12\writer_receipt_PILGRIM_COMPOSITE_V1_SMOKE2.jsonl"`
  * `Get-Content ... -Tail 3`
* FN Top-3 집계

  * `python tools\fn_top3_casebook_v12.py --casebook "C:\g6core\g6_v24\logs\tesla_v12\casebook_<RUN_ID>.jsonl"`
* STUB 주행

  * `python tests\redteam_harness_v12.py --novel "...순례자..." --turns 30/90 --seed 42 --writer_mode STUB --run_id ...`
* 프로필 프리셋 확인

  * `python -c "from engine.world_profile_v12 import PRESETS_V12,mix_profiles_v12; ..."`

## 5) 오늘 생성/수정된 코드 및 파일 위치(확정)

형아가 “tools 폴더에 풀코드 넣었다”고 한 묶음 기준으로, 업로드로 확인된 파일들

* Gate

  * `C:\g6core\g6_v24\engine\gate_judge_v12.py`
* Extractor

  * `C:\g6core\g6_v24\engine\claim_extractor_v12.py`
* Ledger

  * `C:\g6core\g6_v24\engine\ledger_v12.py`
* World profile

  * `C:\g6core\g6_v24\engine\world_profile_v12.py`
* Writer adapter

  * `C:\g6core\g6_v24\engine\writer_adapter_v12.py`
* Tesla evolution/로그 매니저

  * `C:\g6core\g6_v24\engine\tesla_evolution_v12.py`
* Harness

  * `C:\g6core\g6_v24\tests\redteam_harness_v12.py`
* Casebook 샘플 업로드(분석용)

  * `/mnt/data/casebook_20251227_023909_2809f923c5.jsonl`
* 일반오류 알고리즘 분석 문서(검수 기준)

  * `/mnt/data/일반오류알고리즘분석.txt`
* 오늘 일정 개선 문서

  * `/mnt/data/12.27개발일정개선.txt`
* VMCL 도시락 개념 문서

  * `/mnt/data/vmcl도시락개념기술문서.txt`

로그 출력 위치 패턴(오늘 확인된 실제 파일명)

* `C:\g6core\g6_v24\logs\tesla_v12\casebook_<RUN_ID>.jsonl`
* `C:\g6core\g6_v24\logs\tesla_v12\errors_<RUN_ID>.jsonl`
* `C:\g6core\g6_v24\logs\tesla_v12\report_<RUN_ID>.json`
* `C:\g6core\g6_v24\logs\tesla_v12\checkpoint_<RUN_ID>.json`
* `C:\g6core\g6_v24\logs\tesla_v12\writer_receipt_<RUN_ID>.jsonl`  (중요: 폴더 안이 아니라 루트에 생긴 케이스 확인)

## 6) 발견된 문제점 / 원인(오늘 기준)

### 문제점 1: STUB 주행에서 FN이 전부 UNKNOWN으로 나오는 런이 존재

* 원인 후보

  * 케이스북에 poison_bucket/poison_id 기록 누락
  * Extractor 결과(claims)가 비거나 키명이 변경됨
  * 하네스가 기록할 때 필드를 안 넣음

### 문제점 2: REAL Writer가 30턴에서 HTTPError로 멈춤

* 원인

  * 네트워크/키/쿼터/엔드포인트/재시도 정책 이슈
  * writer_receipt에는 `max_retries_exceeded`가 찍힘(영수증 확보됨)

### 문제점 3: 프로필 dataclass frozen 때문에 하네스에서 필드 수정 시 크래시

* 원인

  * 생성 후 수정하는 방식이 구조적으로 불가
  * 프로필은 “mix_profiles_v12로 확정 생성”해야 함

## 7) 오늘 결정 사항(봉인/금지/우선순위)

* 봉인 방향

  * “7대 죄악 다 잡기”는 중단
  * Phase1에서 확실히 먹히는 3개만 유지

    * SPACE/TIME(시공간)
    * STATE(사망/부활/행동 모순)
    * ASSET(아이템/무기 상실-재사용)
* 금지

  * Navigator/FunEngine/자가발전 전체 연결은 지금 금지(디버그 지옥)
* 우선순위

  * 다음은 VMCL “도시락(Priority Recall) + 영수증 박제”를 먼저 붙여서, FN이 왜 났는지 매 턴 추적 가능한 상태로 전환

## 8) 하청(제미나이/외주) 관련 오늘 결론

* “아이템 배선 추가” 같은 제안은 방향은 맞았고, 실제로 TP가 튐
* 하지만 앞으로 하청은 반드시

  * 파일 통째 납품
  * 영수증/증거 박제(무슨 판단을 왜 했는지)
  * 재현성(동일 seed 3회 동일)
    이 3개를 못 맞추면 다시 지옥 감

## 9) 다음 세션(오늘 이후) 해야 할 일 5시간 코스(확정)

* 0:00~0:40

  * VMCL Priority Recall 요구사항(POOL/카트리지/TTL/비상D/영수증 스키마) 문서 박제
* 0:40~2:10

  * `engine/vmcl_priority_recall_v0.py` 신규 구현
* 2:10~3:00

  * 하네스 배선 + `logs/tesla_v12/<run_id>/vmcl_receipt.jsonl` 저장
* 3:00~4:10

  * STUB 200턴 3회 결정론(해시 동일) PASS
* 4:10~5:00

  * SPACE/TIME FN Top-3 중 1개만 수술(Extractor vs Judge 중 하나로 확정)

## 10) 리스크 / 주의사항

* 형아가 채팅에 API 키를 올린 적이 있었음

  * 원칙적으로는 즉시 폐기/재발급 추천(로그/공유/유출 리스크)

---

원하면, 다음 메시지에 내가 바로

* VMCL Priority Recall v0 “하청지시서(풀코드 3파일 납품)”를 더 빡세게
* 또는 내가 직접 “풀코드”로 `vmcl_priority_recall_v0.py + hashcheck + harness 배선`까지 한 번에
  둘 중 하나로 끌고 갈게.

형아는 지금 “뭘 골라?” 같은 거 묻기 싫어하니까, 내가 최적 코스로 리딩하면
다음은 **VMCL 영수증 박제부터 바로 들어간다**가 정답이다.

## 🔎 단계 판정

**[확장 단계]**

오케이 형아. **진짜 초딩버전**으로 “영수증”이랑 “게이트”를 한 번에 연결해서 설명할게.
(치매 방지용으로 **비유 1개**로 끝낸다.)

---

# 1) 전체 비유: “공항 보안검색 + 가방 검사”

우린 지금 소설을 만들 때 매 턴(한 장면)마다 **공항**을 통과시키는 거야.

* **소설 한 턴** = 공항 한 번 통과
* **도시락(VMCL)** = 가방(가져가는 정보)
* **게이트(Gate)** = 보안검색대(규칙 검사)
* **라이트엔진(Writer)** = 비행기 탑승(실제 글 생성)

---

# 2) 영수증이 뭐냐?

영수증은 **“가방 검사 결과 종이”**야.

공항에서 너 가방 검사했잖아?
그럼 직원이 이렇게 적어주는 거야:

* 오늘 가방에 뭐 들어있었는지
* 뭐가 문제였는지
* 통과했는지, 걸렸는지
* 다시 검사(재작성) 했는지

이게 우리 시스템에서 말하는:

✅ `vmcl_receipt.jsonl` = **“가방 내용 영수증”**
✅ `writer_receipt.jsonl` = **“비행기(글 생성) 탑승 기록 영수증”**

---

# 3) 게이트는 뭐냐?

게이트는 **“불량품/금지품 검사”**다.

### Gate가 하는 일

* “이 턴에서 말이 안 되는 거 있냐?”
* “세계관 법 어겼냐?”
* “시간/공간/상태(죽은 애가 살아났다 같은 거) 틀렸냐?”

즉,

* **게이트는 경찰**
* **영수증은 CCTV 기록지**

---

# 4) 왜 영수증이 필수냐? (치매 방지 핵심)

형아가 치매라서가 아니라, **시스템이 치매가 걸려**.

AI는 다음날 되면:

* “어? 내가 뭘 들고 갔더라?”
* “왜 통과했더라?”
* “어디서 틀렸더라?”

이걸 1000턴 하면 완전 붕괴함.

영수증이 있으면:

* 나중에 봐도 “아 이때 가방에 이걸 넣었네”
* “그래서 법 위반이 났네”
* “그래서 재작성했네”
  이게 딱 보임.

---

# 5) “게이트 + 영수증”이 같이 있어야 하는 이유

### 게이트만 있으면?

* 통과/실패는 나오는데
* **왜 그랬는지**가 안 남음 → 다시 못 고침

### 영수증만 있으면?

* 가방에 뭐 들었는지는 알지만
* **검사(법 위반) 판정**이 약하면 장편이 무너짐

그래서 같이 가는 거야.

---

# 6) 우리 지금 어디까지 왔냐 (한 줄)

* Phase1에서 **게이트 검사 + 가방 영수증**을 “봉인(재현성)”까지 찍었고
* 다음은 Phase1.5에서 **법을 어기면 바로 되돌리는 강제력(ImportanceGate)**을 붙이는 거다.

---

원하면 내가 바로 다음 메시지에
**“Gate 영수증에 꼭 박아야 하는 필수 8개 항목”**을 초딩버전으로 딱 정리해줄게.

